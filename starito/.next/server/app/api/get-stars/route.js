(()=>{var a={};a.id=210,a.ids=[210],a.modules={200:(a,b,c)=>{"use strict";c.d(b,{C:()=>m,Dg:()=>s,El:()=>l,FH:()=>p,L3:()=>w,ON:()=>t,Sx:()=>u,UD:()=>o,_K:()=>v,er:()=>q,i0:()=>j,kl:()=>k,lo:()=>i,w5:()=>n,zS:()=>r});let d=process.env.AIRTABLE_BASE_ID,e=process.env.AIRTABLE_API_KEY,f={Authorization:`Bearer ${e}`,"Content-Type":"application/json"};async function g(a,b={}){let c=`https://api.airtable.com/v0/${d}/${a}`,e=await fetch(c,{...b,headers:{...f,...b.headers}});if(!e.ok){let a=await e.text();throw console.error("Airtable API error details:",a),Error(`Airtable API error: ${e.status} ${e.statusText} - ${a}`)}return e.json()}function h(a){let b={...a.fields};return b["Avatar URL"]&&Array.isArray(b["Avatar URL"])&&b["Avatar URL"].length>0?b.avatar_url=b["Avatar URL"][0].url:b.avatar_url=void 0,{id:a.id,...b}}async function i(){return(await g("Users")).records.map(h)}async function j(){return(await g('Users?filterByFormula={Role}="Child"')).records.map(h)}async function k(a){try{let b=await g(`Users/${a}`);return h(b)}catch{return null}}async function l(a){let b=(await g(`Users?filterByFormula=AND({PIN}="${a}",{Role}="Child")`)).records;return b.length>0?h(b[0]):null}async function m(a,b){let c=(await g(`Users?filterByFormula=AND({Username}="${a}",{Password}="${b}",{Role}="Parent")`)).records;return c.length>0?h(c[0]):null}async function n(a,b){console.log("\uD83D\uDD0D getDailyTasksByUser called with:",{userId:a,date:b});let c=await k(a);if(console.log("\uD83D\uDC64 User lookup result:",c),!c)return console.log("❌ No user found for ID:",a),[];if(!b){let a=`{User}="${c.Name}"`;console.log("\uD83D\uDD0D Airtable filter formula (no date):",a);let b=await g(`DailyTasks?filterByFormula=${encodeURIComponent(a)}`);console.log("\uD83D\uDCCA Raw Airtable response:",b);let d=b.records.map(h);return console.log("✅ Transformed tasks:",d),d}let d=[b,b.split("-").reverse().join("/"),(()=>{let[a,c,d]=b.split("-");return`${parseInt(c)}/${parseInt(d)}/${a}`})(),(()=>{let[a,c,d]=b.split("-");return`${c}/${d}/${a}`})()];for(let a of(console.log("\uD83D\uDD0D Trying date formats:",d),d)){let b=`{User}="${c.Name}"`,d=`{Date}="${a}"`,e=`AND(${b},${d})`;console.log("\uD83D\uDD0D Airtable filter formula:",e),console.log("\uD83D\uDD0D Full request URL:",`DailyTasks?filterByFormula=${encodeURIComponent(e)}`);let f=await g(`DailyTasks?filterByFormula=${encodeURIComponent(e)}`);if(console.log("\uD83D\uDCCA Raw Airtable response for",a,":",f),f.records&&f.records.length>0){let b=f.records.map(h);return console.log("✅ Found tasks with date format",a,":",b),b}}console.log("\uD83D\uDD0D No tasks found for specific date, checking all tasks for user...");let e=`{User}="${c.Name}"`,f=await g(`DailyTasks?filterByFormula=${encodeURIComponent(e)}`);console.log("\uD83D\uDCCA All tasks for user:",f);let i=f.records.map(h);return console.log("✅ All user tasks (no date filter):",i),i}async function o(a,b){return h(await g(`DailyTasks/${a}`,{method:"PATCH",body:JSON.stringify({fields:b})}))}async function p(){return(await g("Chores?filterByFormula={Active}=TRUE()")).records.map(h)}async function q(){return(await g("Rewards?filterByFormula={Available}=TRUE()")).records.map(h)}async function r(a){return h(await g("Transactions",{method:"POST",body:JSON.stringify({fields:{...a,Date:new Date().toISOString().split("T")[0]}})}))}async function s(a){return h(await g("DailyTasks",{method:"POST",body:JSON.stringify({fields:a})}))}async function t(a){return h(await g("Challenges",{method:"POST",body:JSON.stringify({fields:a})}))}async function u(a){return h(await g("Rewards",{method:"POST",body:JSON.stringify({fields:{...a,created_at:new Date().toISOString()}})}))}async function v(a){let b=await k(a);return b?(await g(`Transactions?filterByFormula=FIND("${b.Name}",{User})&sort[0][field]=Date&sort[0][direction]=desc`)).records.map(h):[]}async function w(a){return(await v(a)).reduce((a,b)=>a+b.Points,0)}},261:a=>{"use strict";a.exports=require("next/dist/shared/lib/router/utils/app-paths")},846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6439:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external")},6487:()=>{},8335:()=>{},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9382:(a,b,c)=>{"use strict";c.r(b),c.d(b,{handler:()=>C,patchFetch:()=>B,routeModule:()=>x,serverHooks:()=>A,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>z});var d={};c.r(d),c.d(d,{GET:()=>w});var e=c(6559),f=c(8088),g=c(7719),h=c(6191),i=c(1289),j=c(261),k=c(2603),l=c(9893),m=c(4823),n=c(7220),o=c(6946),p=c(7912),q=c(9786),r=c(6143),s=c(6439),t=c(3365),u=c(2190),v=c(200);async function w(a){try{let{searchParams:b}=new URL(a.url),c=b.get("userId");if(!c)return u.NextResponse.json({error:"User ID is required"},{status:400});let d=await (0,v.L3)(c);return u.NextResponse.json({success:!0,stars:d})}catch(a){return console.error("Get stars error:",a),u.NextResponse.json({error:"Failed to calculate stars"},{status:500})}}let x=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/get-stars/route",pathname:"/api/get-stars",filename:"route",bundlePath:"app/api/get-stars/route"},distDir:".next",projectDir:"",resolvedPagePath:"/workspaces/starito/starito/app/api/get-stars/route.ts",nextConfigOutput:"",userland:d}),{workAsyncStorage:y,workUnitAsyncStorage:z,serverHooks:A}=x;function B(){return(0,g.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:z})}async function C(a,b,c){var d;let e="/api/get-stars/route";"/index"===e&&(e="/");let g=await x.prepare(a,b,{srcPage:e,multiZoneDraftMode:"false"});if(!g)return b.statusCode=400,b.end("Bad Request"),null==c.waitUntil||c.waitUntil.call(c,Promise.resolve()),null;let{buildId:u,params:v,nextConfig:w,isDraftMode:y,prerenderManifest:z,routerServerContext:A,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,resolvedPathname:D}=g,E=(0,j.normalizeAppPath)(e),F=!!(z.dynamicRoutes[E]||z.routes[D]);if(F&&!y){let a=!!z.routes[D],b=z.dynamicRoutes[E];if(b&&!1===b.fallback&&!a)throw new s.NoFallbackError}let G=null;!F||x.isDev||y||(G="/index"===(G=D)?"/":G);let H=!0===x.isDev||!F,I=F&&!H,J=a.method||"GET",K=(0,i.getTracer)(),L=K.getActiveScopeSpan(),M={params:v,prerenderManifest:z,renderOpts:{experimental:{dynamicIO:!!w.experimental.dynamicIO,authInterrupts:!!w.experimental.authInterrupts},supportsDynamicResponse:H,incrementalCache:(0,h.getRequestMeta)(a,"incrementalCache"),cacheLifeProfiles:null==(d=w.experimental)?void 0:d.cacheLife,isRevalidate:I,waitUntil:c.waitUntil,onClose:a=>{b.on("close",a)},onAfterTaskError:void 0,onInstrumentationRequestError:(b,c,d)=>x.onRequestError(a,b,d,A)},sharedContext:{buildId:u}},N=new k.NodeNextRequest(a),O=new k.NodeNextResponse(b),P=l.NextRequestAdapter.fromNodeNextRequest(N,(0,l.signalFromNodeResponse)(b));try{let d=async c=>x.handle(P,M).finally(()=>{if(!c)return;c.setAttributes({"http.status_code":b.statusCode,"next.rsc":!1});let d=K.getRootSpanAttributes();if(!d)return;if(d.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${d.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let e=d.get("next.route");if(e){let a=`${J} ${e}`;c.setAttributes({"next.route":e,"http.route":e,"next.span_name":a}),c.updateName(a)}else c.updateName(`${J} ${a.url}`)}),g=async g=>{var i,j;let k=async({previousCacheEntry:f})=>{try{if(!(0,h.getRequestMeta)(a,"minimalMode")&&B&&C&&!f)return b.statusCode=404,b.setHeader("x-nextjs-cache","REVALIDATED"),b.end("This page could not be found"),null;let e=await d(g);a.fetchMetrics=M.renderOpts.fetchMetrics;let i=M.renderOpts.pendingWaitUntil;i&&c.waitUntil&&(c.waitUntil(i),i=void 0);let j=M.renderOpts.collectedTags;if(!F)return await (0,o.I)(N,O,e,M.renderOpts.pendingWaitUntil),null;{let a=await e.blob(),b=(0,p.toNodeOutgoingHttpHeaders)(e.headers);j&&(b[r.NEXT_CACHE_TAGS_HEADER]=j),!b["content-type"]&&a.type&&(b["content-type"]=a.type);let c=void 0!==M.renderOpts.collectedRevalidate&&!(M.renderOpts.collectedRevalidate>=r.INFINITE_CACHE)&&M.renderOpts.collectedRevalidate,d=void 0===M.renderOpts.collectedExpire||M.renderOpts.collectedExpire>=r.INFINITE_CACHE?void 0:M.renderOpts.collectedExpire;return{value:{kind:t.CachedRouteKind.APP_ROUTE,status:e.status,body:Buffer.from(await a.arrayBuffer()),headers:b},cacheControl:{revalidate:c,expire:d}}}}catch(b){throw(null==f?void 0:f.isStale)&&await x.onRequestError(a,b,{routerKind:"App Router",routePath:e,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})},A),b}},l=await x.handleResponse({req:a,nextConfig:w,cacheKey:G,routeKind:f.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:z,isRoutePPREnabled:!1,isOnDemandRevalidate:B,revalidateOnlyGenerated:C,responseGenerator:k,waitUntil:c.waitUntil});if(!F)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==t.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(j=l.value)?void 0:j.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});(0,h.getRequestMeta)(a,"minimalMode")||b.setHeader("x-nextjs-cache",B?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),y&&b.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return(0,h.getRequestMeta)(a,"minimalMode")&&F||m.delete(r.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||b.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,q.getCacheControlHeader)(l.cacheControl)),await (0,o.I)(N,O,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};L?await g(L):await K.withPropagatedContext(a.headers,()=>K.trace(m.BaseServerSpan.handleRequest,{spanName:`${J} ${a.url}`,kind:i.SpanKind.SERVER,attributes:{"http.method":J,"http.target":a.url}},g))}catch(b){if(L||await x.onRequestError(a,b,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,n.c)({isRevalidate:I,isOnDemandRevalidate:B})}),F)throw b;return await (0,o.I)(N,O,new Response(null,{status:500})),null}}}};var b=require("../../../webpack-runtime.js");b.C(a);var c=b.X(0,[985,55],()=>b(b.s=9382));module.exports=c})();